services:
  cowrie:
    image: cowrie/cowrie:latest
    container_name: cowrie
    ports:
      - "2222:2222"
      - "2223:2223"
    volumes:
      # CORRECTION: Le bon chemin pour les logs Cowrie
      - cowrie_logs:/cowrie/cowrie-git/var/log/cowrie
    networks:
      - pysec_network
    restart: unless-stopped

  nids:
    build: ./nids
    container_name: nids
    command: python -u nids.py
    volumes:
      - cowrie_logs:/cowrie_logs:ro
      - ./nids/logs:/app/logs
    networks:
      - pysec_network
    privileged: true
    cap_add:
      - NET_RAW
      - NET_ADMIN
    restart: unless-stopped
    depends_on:
      - cowrie

  attacker:
    build: ./attacker
    container_name: attacker
    networks:
      - pysec_network
    depends_on:
      - cowrie
      - nids

  dashboard:
    build: ./dashboard
    container_name: pysec-dashboard
    ports:
      - "5000:5000"
    volumes:
      - ./nids/logs:/app/logs:ro
    networks:
      - pysec_network
    depends_on:
      - nids
    restart: unless-stopped

networks:
  pysec_network:
    driver: bridge

volumes:
  cowrie_logs:
# Suppression de la définition du volume nommé 'cowrie_logs' car nous utilisons un bind mount.
# volumes:
#   cowrie_logs: